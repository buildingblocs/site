---
import { getEntryBySlug, getCollection } from 'astro:content';
import { format } from 'date-fns';
import Layout from '../../layout.astro';
import Timeline from '../../components/eventpage/timeline';
import Faq from '../../components/eventpage/accordion';
import { Button } from '../../components/ui/button';

const { slug } = Astro.params;
const event = await getEntryBySlug('events', slug);
const events = await getCollection('events');
const upcomingEvents = events.filter((e) => e.data.status === 'open');
const pastEvents = events.filter((e) => e.data.status === 'over');
const currentEvent = event.data;
const { title, status, directions, luma, signupLink, details, excerpt, desc, faq, prospectus, timeline } = currentEvent;
---

<Layout title={title} showTitle={false} desc={excerpt}>
    <main class="max-w-2xl mx-auto px-4">
        <h1 class="text-3xl font-bold mb-4">{title}</h1>
        <p class="text-slate-400 mb-4">{desc}</p>
        <ul class="list-disc list-inside mb-4">
            {details.map((detail) => (
                <li>{detail}</li>
            ))}
        </ul>
        {luma && (
            <div class="mb-4">
                <a href={`https://lu.ma/${luma}`} target="_blank" rel="noopener noreferrer">
                    <Button variant="secondary" class="w-full">
                        Register on Luma
                    </Button>
                </a>
            </div>
        )}
        {signupLink && (
            <div class="mb-4">
                <a href={signupLink} target="_blank" rel="noopener noreferrer">
                    <Button variant="secondary" class="w-full">
                        Sign Up
                    </Button>
                </a>
            </div>
        )}
        {directions && (
            <div class="mb-4">
                <a href={directions} target="_blank" rel="noopener noreferrer">
                    <Button variant="secondary" class="w-full">
                        View Directions
                    </Button>
                </a>
            </div>
        )}
        {prospectus && (
            <div class="mb-4">
                <h2 class="text-2xl font-bold mb-2">Prospectus</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    {prospectus.map((item) => (
                        <img src={item.src} alt="Prospectus" class="rounded-lg border border-slate-700" />
                    ))}
                </div>
            </div>
        )}
        {timeline && (
            <div class="mb-4">
                <h2 class="text-2xl font-bold mb-2">Timeline</h2>
                <Timeline timeline={timeline} />
            </div>
        )}
        {faq && (
            <div class="mb-4">
                <h2 class="text-2xl font-bold mb-2">FAQ</h2>
                <Faq faq={faq} />
            </div>
        )}
        {status === 'open' && (
            <div class="mb-4">
                <h2 class="text-2xl font-bold mb-2">Upcoming Events</h2>
                <ul class="list-disc list-inside">
                    {upcomingEvents.map((event) => (
                        <li>
                            <a href={`/events/${event.slug}`} class="text-blue-500 hover:underline">
                                {event.data.title} - {format(new Date(event.data.date), 'MMMM d, yyyy')}
                            </a>
                        </li>
                    ))}
                </ul>
            </div>
        )}
        {status === 'over' && (
            <div class="mb-4">
                <h2 class="text-2xl font-bold mb-2">Past Events</h2>
                <ul class="list-disc list-inside">
                    {pastEvents.map((event) => (
                        <li>
                            <a href={`/events/${event.slug}`} class="text-blue-500 hover:underline">
                                {event.data.title} - {format(new Date(event.data.date), 'MMMM d, yyyy')}
                            </a>
                        </li>
                    ))}
                </ul>
            </div>
        )}
    </main>
</Layout>
